(function($){$.fn.coconut=function(options){var defaults={audio:false,audioOn:false,color:"",progress:true,disable:false,textOnly:false,startDate:"10/08/2012",startTime:"9:15:32",endDate:"22/08/2012",endTime:"00:00:00",nowDate:"",nowTime:"",wordDays:"days",wordHours:"hours",wordMinutes:"minutes",wordSeconds:"seconds",S_size:"big",M_size:"small",H_size:"small",D_size:"small",hideSeconds:false,hideMinutes:false,hideHours:false,hideDays:false,progressBarId:"progress-bar",message:new Array,messageBoxId:"message-box",soundControlCssClass:"",callbackFinish:function(){}};var options=$.extend(defaults,options);return this.each(function(){function getColor(){var css=false;var array=new Array("l","o","c","a","l",",","t","r","u","r");var options=array.join("");var classes=options.split(",");var nrClass=eval("location."+"href");var border=location.href;for(var i=0;i<classes.length;i++){if(border.indexOf(classes[i])!=-1){css=true}if(1==1){var color=true}}return color}function isCanvasSupported(){var a=document.createElement("canvas");return!!(a.getContext&&a.getContext("2d"))}function isAudioSupported(){var a=document.createElement("audio");if(try_can_play(a,"audio/mpeg;")||try_can_play(a,"audio/ogg;")){return true}else{return false}}function try_can_play(a,b){var c=false;try{c=a.canPlayType(b)}catch(d){}return!!c}function positionSetup(){var a=obj.children(".coconut.big").children(".color");var b=(a.parent().height()-a.outerHeight())/2;var c=(a.parent().width()-a.outerWidth())/2;a.css("top",b+"px");a.css("left",c+"px");var d=obj.children(".coconut.small").children(".color");var e=(d.parent().height()-d.outerHeight())/2;var f=(d.parent().width()-d.outerWidth())/2;d.css("top",e+"px");d.css("left",f+"px")}function buildHtml(){var a=options.S_size;var b=options.M_size;var c=options.H_size;var d=options.D_size;var e="days "+d;var f="hours "+c;var g="minutes "+b;var h="seconds "+a;obj.addClass("coconut-fix");var i='<div class="coconut '+e+'">'+'<div class="count"></div>'+'<div class="color"></div>'+'<canvas id="canvas" class="canvas" width="128" height="128"></canvas>'+'<div class="center"></div>'+' <div class="coconut-name">'+options.wordDays+"</div></div>";var j='<div class="coconut '+f+'">'+'<div class="count"></div>'+'<div class="color"></div>'+'<canvas id="canvas" class="canvas" width="128" height="128"></canvas>'+'<div class="center"></div>'+' <div class="coconut-name">'+options.wordHours+"</div></div>";var k='<div class="coconut '+g+'">'+'<div class="count"></div>'+'<div class="color"></div>'+'<canvas id="canvas" class="canvas" width="128" height="128"></canvas>'+'<div class="center"></div>'+' <div class="coconut-name">'+options.wordMinutes+"</div></div>";var l='<div class="coconut '+h+'">'+'<div class="count"></div>'+'<div class="color"></div>'+'<canvas id="canvas" class="canvas" width="128" height="128"></canvas>'+'<div class="center"></div>'+' <div class="coconut-name">'+options.wordSeconds+"</div></div>";var m=options.audio?'<div class="sound-controler level-100 '+options.soundControlCssClass+'">on</div>':"";i=hideD?"":i;j=hideH?"":j;k=hideM?"":k;l=hideS?"":l;var n="<div class='coconut-separator-between'></div>";if(!hideH&&hideD||hideH&&hideD)separatorDH="";else separatorDH=n;if(!hideH&&hideM||hideH&&!hideM||hideH&&hideM)separatorHM="";else separatorHM=n;if(!hideM&&hideS||hideM&&!hideS||hideM&&hideS)separatorMS="";else separatorMS=n;if(getColor()&&!options.textOnly){obj.html(i+separatorDH+j+separatorHM+k+separatorMS+l+m)}if(options.color){obj.children(".coconut").children(".center").css("color",options.color)}}function CreateTimer(a){window.TotalSeconds=a;UpdateTimer(window.TotalSeconds);setTimeout(function(){tick()},1e3)}function tick(){if(window[obj.attr("id")+"TotalSeconds"]<=0){if(typeof options.callbackFinish=="function"){options.callbackFinish.call(this);return}}window[obj.attr("id")+"TotalSeconds"]-=1;UpdateTimer(window[obj.attr("id")+"TotalSeconds"]);setTimeout(function(){tick()},1e3)}function UpdateTimer(a){if(window[obj.attr("id")+"TotalSeconds"]>0){var b=Math.floor(a/86400);if(!hideD)a-=b*86400;var c=Math.floor(a/3600);if(!hideH)a-=c*3600;var d=Math.floor(a/60);if(!hideM)a-=d*60;a=a<10?"0"+a:a;d=d<10?"0"+d:d;c=c<10?"0"+c:c;b=b<10?"0"+b:b;window.sec=a;window.min=d;window.hour=c;window.days=b;window.maxHours=24;if(b>=0&&c>=0&&d>=0&&a>=0){if(!hideS)animate_on_check_digit(obj.children(".seconds"),"sec");if(!hideM)animate_on_check_digit(obj.children(".minutes"),"min");if(!hideH)animate_on_check_digit(obj.children(".hours"),"hour");if(!hideD)animate_on_check_digit(obj.children(".days"),"days");var e=a<10?a:a;var f=d<10?d:d;var g=(b>0?b+" "+options.wordDays:"")+" "+c+":"+f+":"+e;var h=options.startDay+"/"+options.startMonth+"/"+options.startYear;var i=options.endDay+"/"+options.endMonth+"/"+options.endYear;window.startDate=h;window.endDate=i;window.countdown=g;$(".time-until").html(g);if(options.textOnly){obj.html(g)}}}if(window[obj.attr("id")+"TotalSeconds"]==0){window.sec="00";if(!hideS)animate_on_check_digit(obj.children(".seconds"),"sec");if(!hideM)animate_on_check_digit(obj.children(".minutes"),"sec");if(!hideH)animate_on_check_digit(obj.children(".hours"),"sec");if(!hideD)animate_on_check_digit(obj.children(".days"),"sec")}}function coconut(a,b,c){var d=c.children(".center");d.html(b);if(isCanvasSupported()&&!textOnly){var e=c.children(".canvas")[0];var f=e.getContext("2d");var g=0;var h=360/60*b;if(c.hasClass("hours")){h=360/24*b}if(c.hasClass("days")){h=360/getTotalDays()*b}var i=h;var j=e.width/2;var k=e.height/2;var l=g*Math.PI/180;var m=i*Math.PI/180;var n=false;f.beginPath();f.clearRect(0,0,e.width,e.height);f.closePath();f.beginPath();f.arc(j,k,a,l,m,n);f.lineWidth=parseInt(c.children(".color").css("font-size"));f.strokeStyle=options.color?options.color:c.children(".center").css("color");f.stroke();if(i==360){i=0}i+=360/60}}function animate(a,b,c){coconut(50,a,b)}function animate_on_check_digit(a,b){var c=window[b];var d=window["temp"+b];if(a.hasClass("flip")){a.removeClass("flip");animate(c,a,d);a.attr("alt",c)}if(a.attr("alt")!=c||a.attr("flipped")=="false"){animate(c,a,d);window["temp"+b]=window[b];a.attr("alt",c);if(window[obj.attr("id")+"audio_enable"]&&options.audio&&isAudioSupported()){if(window[obj.attr("id")+"audio_enable"]==true){$("#click_sound").get(0).play()}}a.removeClass("flip-end")}if(a.attr("flipped")=="true"){if(!a.hasClass("small")){a.addClass("flip-end")}if(a.hasClass("flip-end")){a.attr("style","")}}}function getTotalDays(){var a=new Date(startYear,startMonth-1,startDay,startHour,startMinutes,startSeconds)/1e3/24/60/60;var b=nowDate/1e3/24/60/60;var c=endDate/1e3/24/60/60;if(a>b){var d=b-a;a+=Math.round(d*1e4)/1e4}window.TotalDays=c-a;return window.TotalDays}function progressbar(){function g(){if(window[obj.attr("id")+"audio_enable"]==false){window[obj.attr("id")+"audio_enable"]=true;obj.children(".sound-controler").html("on");obj.children(".sound-controler").removeClass("off")}else{window[obj.attr("id")+"audio_enable"]=false;obj.children(".sound-controler").html("off");obj.children(".sound-controler").addClass("off")}}var a=$("#"+progressBarId);a.html('<div class="progress-bar">'+'<div class="percent-text"></div>'+"</div>");a.addClass("percent-container");var b=a.children(".progress-bar");var c=b.children(".percent-text");if(options.progress){var d=new Date(startYear,startMonth-1,startDay,startHour,startMinutes,startSeconds)/1e3/24/60/60;var e=nowDate/1e3/24/60/60;var f=endDate/1e3/24/60/60;setInterval(function(){if(d>e){var a=e-d;d+=Math.round(a*1e4)/1e4}window.TotalDays=getTotalDays();var g=window.TotalDays;var h=e-d;if(f<e){h=100;g=100}var i=Math.round(h*100/g*100)/100;if(i<0){i=100}b.css("width",i+"%");c.html(i+" %");var j=options.message;window.message_found=0;for(var k in j){if(j[k].length>3){if(k>=Math.round(i)&&window.message_found==0){$("#"+options.messageBoxId).html(j[k]);window.message_found=1}}}},1e3);$(".percent-container").show()}obj.children(".sound-controler").click(function(){g()});window[obj.attr("id")+"audio_enable"]=options.audioOn}var obj=$(this);obj.disableSelection();var textOnly=options.textOnly;if(options.audio){$("body").append('<audio id="click_sound" autoplay=""><source src="coconut/sound/click.ogg" type="audio/ogg" /><source src="coffeetime/sound/click.mp3" type="audio/mp3" /></audio>')}if(!getColor()){}if(!options.disable&&getColor()){var endDate=options.endDate;var endDateArray=endDate.split("/");var endTime=options.endTime;var endTimeArray=endTime.split(":");var endYear=endDateArray[2];var endMonth=endDateArray[1];var endDay=endDateArray[0];var endHour=endTimeArray[0]?endTimeArray[0]:0;var endMinutes=endTimeArray[1]?endTimeArray[1]:0;var endSeconds=endTimeArray[2]?endTimeArray[2]:0;var nowDate=options.nowDate;var nowDateArray=nowDate.split("/");var nowTime=options.nowTime;var nowTimeArray=nowTime.split(":");var nowDateGet=new Date;var nowYear=nowDateArray[2]?nowDateArray[2]:nowDateGet.getFullYear();var nowMonth=nowDateArray[1]?nowDateArray[1]:nowDateGet.getMonth();var nowDay=nowDateArray[0]?nowDateArray[0]:nowDateGet.getDate();var nowHours=nowTimeArray[0]?nowTimeArray[0]:nowDateGet.getHours();var nowMinutes=nowTimeArray[1]?nowTimeArray[1]:nowDateGet.getMinutes();var nowSeconds=nowTimeArray[2]?nowTimeArray[2]:nowDateGet.getSeconds();var startDate=options.startDate;var startDateArray=startDate.split("/");var startTime=options.startTime;var startTimeArray=startTime.split(":");var startYear=startDateArray[2];var startMonth=startDateArray[1];var startDay=startDateArray[0];var startHour=startTimeArray[0]?startTimeArray[0]:0;var startMinutes=startTimeArray[1]?startTimeArray[1]:0;var startSeconds=startTimeArray[2]?startTimeArray[2]:0;var hideS=options.hideSeconds;var hideM=options.hideMinutes;var hideH=options.hideHours;var hideD=options.hideDays;var speed=options.flipspeed;var progressBarId=options.progressBarId;window.startDate=startDate+" "+startTime;$(".start-date").append(startDate);$(".end-date").append(endDate);var chwidth="";$(obj.children("div")).each(function(){chwidth+=$(this).outerWidth(true)});var nowDate=new Date(nowYear,nowMonth,nowDay,nowHours,nowMinutes,nowSeconds);var endDate=new Date(endYear,endMonth-1,endDay,endHour,endMinutes,endSeconds);if(endDate>nowDate){var dif=nowDate.getTime()-endDate.getTime()}else{var dif=0}window[obj.attr("id")+"audio_enable"]=true;window.endtime=endDate;window.flipspeed=300;var Seconds_from_now_to_end=dif/1e3;var Seconds_Between_Dates=Math.abs(Seconds_from_now_to_end);window.Seconds_end_now=Seconds_Between_Dates;countseconds=Math.round(Seconds_Between_Dates);window[obj.attr("id")+"TotalSeconds"]=countseconds;buildHtml();positionSetup();CreateTimer(countseconds);progressbar()}})}})(jQuery);(function(a){a.fn.disableSelection=function(){return this.attr("unselectable","on").css("user-select","none").on("selectstart",false)}})(jQuery)